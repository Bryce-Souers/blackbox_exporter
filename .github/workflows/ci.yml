---
name: CI
on:
  - push
  - pull_request
jobs:
  #test:
  #  strategy:
  #    matrix:
  #      os:
  #        - ubuntu-latest
  #        - windows-latest
  #        - macos-latest
  #  runs-on: ${{ matrix.os }}
  #  steps:
  #    - uses: actions/checkout@v4.2.2
  #    - uses: actions/setup-go@v5.2.0
  #      with:
  #        go-version: 1.23
  #    - run: make build
  #    - run: make test GOOPTS=-v

  build:
    strategy:
      matrix:
        thread: [0, 1, 2, 3, 4, 5]
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4.2.2

      - name: Create .build directory to store artifacts
        run: mkdir -p .build

      - name: Set up promu
        run: make promu

      - name: Cross-build for common architectures
        run: ~/go/bin/promu crossbuild -v --parallelism 6 --parallelism-thread ${{ matrix.thread }} -p linux

      - name: Upload build artifacts
        uses: actions/upload-artifact@v4.5.0
        with:
          path: ${{ github.workspace }}/.build
          if-no-files-found: error
          include-hidden-files: true
